<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Preprocessing with variance threshold, zscore and PCA &mdash; julearn  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Reference" href="../../api.html" />
    <link rel="prev" title="Regression Analysis" href="run_example_pca_featsets.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/julearn_logo_it.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing julearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input.html">Input Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pipeline.html">Understanding the pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scoring.html">Scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steps.html">Available Pipeline Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hyperparameters.html">Hyperparameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/index.html">Basic Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="run_combine_pandas.html">Working with pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="dis_run_target_confound_removal.html">Confound Removal (model comparison)</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_stacked_models.html">Stacking Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_grouped_cv.html">Grouped CV.</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_custom_scorers_regression.html">Custom Scoring Function for Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_hyperparameter_tuning.html">Tuning Hyperparameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="dis_run_return_confounds.html">Return Confounds in Confound Removal</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_example_pca_featsets.html">Regression Analysis</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Preprocessing with variance threshold, zscore and PCA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to julearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintaining.html">Maintaining julearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whats_new.html">What’s new</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">julearn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Advanced Examples</a></li>
      <li class="breadcrumb-item active">Preprocessing with variance threshold, zscore and PCA</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/auto_examples/advanced/plot_transform_until.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-advanced-plot-transform-until-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="preprocessing-with-variance-threshold-zscore-and-pca">
<span id="sphx-glr-auto-examples-advanced-plot-transform-until-py"></span><h1>Preprocessing with variance threshold, zscore and PCA<a class="headerlink" href="#preprocessing-with-variance-threshold-zscore-and-pca" title="Permalink to this heading"></a></h1>
<p>This example uses the ‘make_regression’ function to create a simple dataset,
performs a simple regression after the pre-processing of the features
including removal of low variance features, feature normalization for only
two features using zscore and feature reduction using PCA.
We will check the features after each preprocessing step.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Shammi More &lt;s.more@fz-juelich.de&gt;</span>
<span class="c1">#          Leonard Sasse &lt;l.sasse@fz-juelich.de&gt;</span>
<span class="c1"># License: AGPL</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.make_regression.html#sklearn.datasets.make_regression" title="sklearn.datasets.make_regression" class="sphx-glr-backref-module-sklearn-datasets sphx-glr-backref-type-py-function"><span class="n">make_regression</span></a>

<span class="kn">from</span> <span class="nn">julearn</span> <span class="kn">import</span> <span class="n">run_cross_validation</span>
<span class="kn">from</span> <span class="nn">julearn.inspect.preprocess</span> <span class="kn">import</span> <span class="n">preprocess</span>
<span class="kn">from</span> <span class="nn">julearn.pipeline</span> <span class="kn">import</span> <span class="n">PipelineCreator</span>
<span class="kn">from</span> <span class="nn">julearn.utils</span> <span class="kn">import</span> <span class="n">configure_logging</span>
</pre></div>
</div>
<p>Set the logging level to info to see extra information</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">configure_logging</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2023-04-06 08:39:12,427 - julearn - INFO - ===== Lib Versions =====
2023-04-06 08:39:12,427 - julearn - INFO - numpy: 1.23.5
2023-04-06 08:39:12,428 - julearn - INFO - scipy: 1.10.1
2023-04-06 08:39:12,428 - julearn - INFO - sklearn: 1.2.2
2023-04-06 08:39:12,428 - julearn - INFO - pandas: 1.5.3
2023-04-06 08:39:12,428 - julearn - INFO - julearn: 0.2.6.dev140
2023-04-06 08:39:12,428 - julearn - INFO - ========================
</pre></div>
</div>
<p>Create a dataset using sklearn’s make_regression</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)],</span> <span class="s2">&quot;y&quot;</span>
<span class="n">df</span><span class="p">[</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">],</span> <span class="n">df</span><span class="p">[</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">]</span> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.make_regression.html#sklearn.datasets.make_regression" title="sklearn.datasets.make_regression" class="sphx-glr-backref-module-sklearn-datasets sphx-glr-backref-type-py-function"><span class="n">make_regression</span></a><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">n_informative</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="c1"># We only want to zscore the first two features, so let&#39;s get their names.</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">first_two</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># We can define a dictionary, in which the &#39;key&#39; defines the names of our</span>
<span class="c1"># different &#39;types&#39; of &#39;X&#39;. The &#39;value&#39; determine, which features belong to</span>
<span class="c1"># this type.</span>
<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_types</span></a> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X_to_zscore&quot;</span><span class="p">:</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">first_two</span></a><span class="p">}</span>
</pre></div>
</div>
<p>Let’s look at the summary statistics of the raw features</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Summary Statistics of the raw features : </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Summary Statistics of the raw features :
         Feature 1   Feature 2   Feature 3   Feature 4           y
count  100.000000  100.000000  100.000000  100.000000  100.000000
mean    -0.111790    0.141618    0.023682   -0.167718  -14.686170
std      0.977322    0.972988    1.087946    0.895011   79.741431
min     -2.069985   -2.772593   -2.552990   -2.659172 -204.293317
25%     -0.751257   -0.484100   -0.759419   -0.688891  -64.724008
50%     -0.206729    0.194442   -0.028152   -0.174160  -16.789944
75%      0.421885    0.724302    0.772156    0.408321   30.392804
max      1.943621    2.256723    2.383145    2.259309  216.221085
</pre></div>
</div>
<p>We will preprocess all features using variance thresholding.
We will only zscore the first two features, and then perform PCA using all
features. We will zscore the target and then train a random forest model.
Since we use the PipelineCreator object we have to explicitly declare which
<cite>X_types</cite> each preprocessing step should be applied to. If we do not declare
the type in the ‘add’ method using the ‘apply_to’ keyword argument,
the step will default to ‘continuous’ or to another type that can be declared
in the ‘init’ method of the ‘PipelineCreator’.
To transform the target we could set ‘apply_to=’target’’, which is a special
type, that cannot be user-defined. Please note also that if a step is added
to transform the target, you also have to explicitly add the model that is
to be used in the regression to the ‘PipelineCreator’.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define model parameters and preprocessing steps first</span>
<span class="c1"># The hyperparameters for each step can be added as a keyword argument and</span>
<span class="c1"># should be either one parameter or an iterable of multiple parameters for a</span>
<span class="c1"># search.</span>

<span class="c1"># Setting the threshold for variance to 0.15, number of PCA components to 2</span>
<span class="c1"># and number of trees for random forest to 200</span>

<span class="c1"># By setting &quot;apply_to=*&quot;, we can apply the preprocessing step to all features.</span>
<span class="n">pipeline_creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">)</span>

<span class="n">pipeline_creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;select_variance&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">pipeline_creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;zscore&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;X_to_zscore&quot;</span><span class="p">)</span>
<span class="n">pipeline_creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pipeline_creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;rf&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

<span class="c1"># Because we have already added the model to the pipeline creator, we can</span>
<span class="c1"># simply drop in the pipeline_creator as a model. If we did not add a model</span>
<span class="c1"># here, we could add the pipeline_creator using the keyword argument</span>
<span class="c1"># &#39;preprocess&#39; and hand over a model separately.</span>

<span class="n">scores</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_types</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_types</span></a><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="o">=</span><span class="n">pipeline_creator</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">,</span> <span class="s2">&quot;neg_mean_absolute_error&quot;</span><span class="p">],</span>
    <span class="n">return_estimator</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># We can use the final estimator to inspect the transformed features at a</span>
<span class="c1"># specific step of the pipeline. Since the PCA was the last step added to the</span>
<span class="c1"># pipeline, we can simply get the model up to this step by indexing as follows:</span>

<span class="n">X_after_pca</span> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X after PCA:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">79</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_after_pca</span><span class="p">)</span>

<span class="c1"># We can select pipelines up to earlier steps by indexing previous elements</span>
<span class="c1"># in the final estimator. For example, to inspect features after the zscoring</span>
<span class="c1"># step:</span>

<span class="n">X_after_zscore</span> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;X after zscore:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">79</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_after_zscore</span><span class="p">)</span>

<span class="c1"># However, to make this less confusing you can also simply use the high-level</span>
<span class="c1"># function &#39;preprocess&#39; to explicitly refer to a pipeline step by name:</span>

<span class="n">X_after_pca</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="s2">&quot;pca&quot;</span><span class="p">)</span>
<span class="n">X_after_zscore</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="s2">&quot;zscore&quot;</span><span class="p">)</span>

<span class="c1"># Let&#39;s plot scatter plots for raw features and the PCA components</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Raw features&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;pca__pca0&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">y</span></a><span class="o">=</span><span class="s2">&quot;pca__pca1&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">X_after_pca</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;PCA components&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_plot_transform_until_001.png" srcset="../../_images/sphx_glr_plot_transform_until_001.png" alt="Raw features, PCA components" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2023-04-06 08:39:12,448 - julearn - INFO - Adding step select_variance that applies to ColumnTypes&lt;types={&#39;*&#39;}; pattern=.*&gt;
2023-04-06 08:39:12,448 - julearn - INFO - Setting hyperparameter threshold = 0.15
2023-04-06 08:39:12,448 - julearn - INFO - Step added
2023-04-06 08:39:12,448 - julearn - INFO - Adding step zscore that applies to ColumnTypes&lt;types={&#39;X_to_zscore&#39;}; pattern=(?:__:type:__X_to_zscore)&gt;
2023-04-06 08:39:12,448 - julearn - INFO - Step added
2023-04-06 08:39:12,448 - julearn - INFO - Adding step pca that applies to ColumnTypes&lt;types={&#39;*&#39;}; pattern=.*&gt;
2023-04-06 08:39:12,448 - julearn - INFO - Setting hyperparameter n_components = 2
2023-04-06 08:39:12,448 - julearn - INFO - Step added
2023-04-06 08:39:12,449 - julearn - INFO - Adding step rf that applies to ColumnTypes&lt;types={&#39;*&#39;}; pattern=.*&gt;
2023-04-06 08:39:12,449 - julearn - INFO - Setting hyperparameter n_estimators = 200
2023-04-06 08:39:12,449 - julearn - INFO - Step added
2023-04-06 08:39:12,449 - julearn - INFO - Setting random seed to 200
2023-04-06 08:39:12,449 - julearn - INFO - ==== Input Data ====
2023-04-06 08:39:12,449 - julearn - INFO - Using dataframe as input
2023-04-06 08:39:12,449 - julearn - INFO -      Features: [&#39;Feature 1&#39;, &#39;Feature 2&#39;, &#39;Feature 3&#39;, &#39;Feature 4&#39;]
2023-04-06 08:39:12,449 - julearn - INFO -      Target: y
2023-04-06 08:39:12,449 - julearn - INFO -      Expanded features: [&#39;Feature 1&#39;, &#39;Feature 2&#39;, &#39;Feature 3&#39;, &#39;Feature 4&#39;]
2023-04-06 08:39:12,449 - julearn - INFO -      X_types:{&#39;X_to_zscore&#39;: [&#39;Feature 1&#39;, &#39;Feature 2&#39;]}
2023-04-06 08:39:12,450 - julearn - WARNING - The following columns are not defined in X_types: [&#39;Feature 3&#39;, &#39;Feature 4&#39;]. They will be treated as continuous.
/home/runner/work/julearn/julearn/julearn/utils/logging.py:238: RuntimeWarning: The following columns are not defined in X_types: [&#39;Feature 3&#39;, &#39;Feature 4&#39;]. They will be treated as continuous.
  warn(msg, category=category)
2023-04-06 08:39:12,451 - julearn - INFO - ====================
2023-04-06 08:39:12,451 - julearn - INFO -
2023-04-06 08:39:12,453 - julearn - INFO - = Model Parameters =
2023-04-06 08:39:12,453 - julearn - INFO - ====================
2023-04-06 08:39:12,453 - julearn - INFO -
2023-04-06 08:39:12,453 - julearn - INFO - = Data Information =
2023-04-06 08:39:12,453 - julearn - INFO -      Problem type: regression
2023-04-06 08:39:12,453 - julearn - INFO -      Number of samples: 100
2023-04-06 08:39:12,453 - julearn - INFO -      Number of features: 4
2023-04-06 08:39:12,453 - julearn - INFO - ====================
2023-04-06 08:39:12,453 - julearn - INFO -
2023-04-06 08:39:12,453 - julearn - INFO -      Target type: float64
2023-04-06 08:39:12,453 - julearn - INFO - Using outer CV scheme KFold(n_splits=5, random_state=None, shuffle=False)
X after PCA:
===============================================================================
    pca__pca0  pca__pca1
0    1.725696  -1.582295
1    0.314458  -0.942935
2    0.977336   0.463217
3    0.525139  -0.219493
4   -1.618559   0.908592
..        ...        ...
95  -0.395105   0.743192
96  -0.328111  -0.670912
97  -0.573900  -0.401304
98   0.918034   0.137435
99   0.894566   0.357729

[100 rows x 2 columns]
X after zscore:
===============================================================================
    Feature 1__:type:__X_to_zscore  ...  Feature 4__:type:__continuous
0                        -2.013728  ...                       0.426259
1                        -0.364686  ...                      -0.944446
2                         0.118838  ...                       0.931848
3                        -0.004437  ...                      -2.030684
4                         0.309092  ...                       0.523891
..                             ...  ...                            ...
95                       -0.206189  ...                      -0.157667
96                       -1.099154  ...                      -0.028182
97                       -0.335538  ...                      -1.252795
98                       -0.049139  ...                      -0.133702
99                        0.240085  ...                       0.443863

[100 rows x 4 columns]

Text(0.5, 1.0, &#39;PCA components&#39;)
</pre></div>
</div>
<p>Let’s look at the summary statistics of the zscored features. We see here
that the mean of all the features is zero and standard deviation is one.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Summary Statistics of the zscored features : </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">X_after_zscore</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Summary Statistics of the zscored features :
           Feature 1     Feature 2   Feature 3   Feature 4
count  1.000000e+02  1.000000e+02  100.000000  100.000000
mean  -5.689893e-17  1.387779e-17    0.023682   -0.167718
std    1.005038e+00  1.005038e+00    1.087946    0.895011
min   -2.013728e+00 -3.010202e+00   -2.552990   -2.659172
25%   -6.576015e-01 -6.463286e-01   -0.759419   -0.688891
50%   -9.763131e-02  5.456486e-02   -0.028152   -0.174160
75%    5.488094e-01  6.018781e-01    0.772156    0.408321
max    2.113700e+00  2.184776e+00    2.383145    2.259309
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  1.847 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-advanced-plot-transform-until-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/f5cf80bc7e6ec76734a5bced1f3dd6fd/plot_transform_until.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_transform_until.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/59ba6d44ff9eb80b13834b334a9dd7fa/plot_transform_until.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_transform_until.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="run_example_pca_featsets.html" class="btn btn-neutral float-left" title="Regression Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../api.html" class="btn btn-neutral float-right" title="Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Authors of julearn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CB4ETK4DBG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-CB4ETK4DBG', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>

.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/advanced/dis_run_grouped_cv.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_advanced_dis_run_grouped_cv.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_advanced_dis_run_grouped_cv.py:


Grouped CV.
===========

This example uses the 'fMRI' dataset and performs GroupKFold
Cross-Validation for classification using Random Forest Classifier.

References
----------
Waskom, M.L., Frank, M.C., Wagner, A.D. (2016). Adaptive engagement of
cognitive control in context-dependent decision-making. Cerebral Cortex.


.. include:: ../../links.inc

.. GENERATED FROM PYTHON SOURCE LINES 17-35

.. code-block:: default


    # Authors: Federico Raimondo <f.raimondo@fz-juelich.de>
    #          Shammi More <s.more@fz-juelich.de>
    #          Kimia Nazarzadeh <k.nazarzadeh@fz-juelich.de>


    #
    # License: AGPL
    # Importing the necessary Python libraries
    import numpy as np

    from seaborn import load_dataset
    from sklearn.model_selection import GroupKFold

    from julearn.utils import configure_logging
    from julearn import run_cross_validation
    from julearn.model_selection import StratifiedGroupsKFold


.. GENERATED FROM PYTHON SOURCE LINES 36-37

Set the logging level to info to see extra information

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: default

    configure_logging(level="INFO")


.. GENERATED FROM PYTHON SOURCE LINES 40-43

Dealing with Cross-Validation techniques
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^


.. GENERATED FROM PYTHON SOURCE LINES 43-46

.. code-block:: default


    df_fmri = load_dataset('fmri')


.. GENERATED FROM PYTHON SOURCE LINES 47-49

First, lets get some information on what the dataset has:


.. GENERATED FROM PYTHON SOURCE LINES 49-52

.. code-block:: default


    print(df_fmri.head())


.. GENERATED FROM PYTHON SOURCE LINES 53-58

From this information, we can infer that it is an fMRI study in which there
were several subjects, timepoints, events and signal extracted from several
brain regions.

Lets check how many kinds of each we have.

.. GENERATED FROM PYTHON SOURCE LINES 58-63

.. code-block:: default

    print(df_fmri['event'].unique())
    print(df_fmri['region'].unique())
    print(sorted(df_fmri['timepoint'].unique()))
    print(df_fmri['subject'].unique())


.. GENERATED FROM PYTHON SOURCE LINES 64-67

We have data from parietal and frontal regions during 2 types of events
(*cue* and *stim*) during 18 timepoints and for 14 subjects.
Lets see how many samples we have for each condition

.. GENERATED FROM PYTHON SOURCE LINES 67-72

.. code-block:: default


    print(df_fmri.groupby(['subject', 'timepoint', 'event', 'region']).count())
    print(np.unique(df_fmri.groupby(
        ['subject', 'timepoint', 'event', 'region']).count().values))


.. GENERATED FROM PYTHON SOURCE LINES 73-79

We have exactly one value per condition.

Lets try to build a model, that uses parietal and frontal signal to predicts
whether the event was a *cue* or a *stim*.

First we define our X and y variables.

.. GENERATED FROM PYTHON SOURCE LINES 79-82

.. code-block:: default

    X = ['parietal', 'frontal']
    y = 'event'


.. GENERATED FROM PYTHON SOURCE LINES 83-88

In order for this to work, both *parietal* and *frontal* must be columns.
We need to *pivot* the table.

The values of *region* will be the columns. The column *signal* will be the
values. And the columns *subject*, *timepoint* and *event* will be the index

.. GENERATED FROM PYTHON SOURCE LINES 88-95

.. code-block:: default

    df_fmri = df_fmri.pivot(
        index=['subject', 'timepoint', 'event'],
        columns='region',
        values='signal')

    df_fmri = df_fmri.reset_index()


.. GENERATED FROM PYTHON SOURCE LINES 96-98

Here we want to zscore all the features and then train a Support Vector
Machine classifier.

.. GENERATED FROM PYTHON SOURCE LINES 98-104

.. code-block:: default


    scores = run_cross_validation(X=X, y=y, data=df_fmri, preprocess='zscore',
                                  model='rf')

    print(scores['test_score'].mean())


.. GENERATED FROM PYTHON SOURCE LINES 105-106

Train classification model with stratification on data

.. GENERATED FROM PYTHON SOURCE LINES 106-113

.. code-block:: default

    cv_stratified = StratifiedGroupsKFold(n_splits=2)
    scores, model = run_cross_validation(
        X=X, y=y, data=df_fmri, groups='subject',
        model='rf', cv=cv_stratified, return_estimator="final")

    print(scores['test_score'].mean())


.. GENERATED FROM PYTHON SOURCE LINES 114-115

Train classification model without stratification on data

.. GENERATED FROM PYTHON SOURCE LINES 115-121

.. code-block:: default

    cv = GroupKFold(n_splits=2)
    scores, model = run_cross_validation(
        X=X, y=y, data=df_fmri, groups='subject',
        model='rf', cv=cv, return_estimator="final")

    print(scores['test_score'].mean())


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.000 seconds)


.. _sphx_glr_download_auto_examples_advanced_dis_run_grouped_cv.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: dis_run_grouped_cv.py <dis_run_grouped_cv.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: dis_run_grouped_cv.ipynb <dis_run_grouped_cv.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_

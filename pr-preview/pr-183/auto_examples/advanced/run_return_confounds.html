<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Return Confounds in Confound Removal &mdash; julearn  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Regression Analysis" href="run_example_pca_featsets.html" />
    <link rel="prev" title="Tuning Hyperparameters" href="run_hyperparameter_tuning.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/julearn_logo_it.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing julearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input.html">Input Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pipeline.html">Understanding the pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scoring.html">Scoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../steps.html">Available Pipeline Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hyperparameters.html">Hyperparameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/index.html">Basic Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Advanced Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="run_combine_pandas.html">Working with pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="dis_run_target_confound_removal.html">Confound Removal (model comparison)</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_stacked_models.html">Stacking Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_grouped_cv.html">Grouped CV.</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_custom_scorers_regression.html">Custom Scoring Function for Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_hyperparameter_tuning.html">Tuning Hyperparameters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Return Confounds in Confound Removal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#confound-removal-typical-use-case">Confound Removal Typical Use Case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="run_example_pca_featsets.html">Regression Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_preprocess.html">Preprocessing with variance threshold, zscore and PCA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to julearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintaining.html">Maintaining julearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../whats_new.html">What’s new</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">julearn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Advanced Examples</a></li>
      <li class="breadcrumb-item active">Return Confounds in Confound Removal</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/auto_examples/advanced/run_return_confounds.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-advanced-run-return-confounds-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="return-confounds-in-confound-removal">
<span id="sphx-glr-auto-examples-advanced-run-return-confounds-py"></span><h1>Return Confounds in Confound Removal<a class="headerlink" href="#return-confounds-in-confound-removal" title="Permalink to this heading"></a></h1>
<p>In most cases confound removal is a simple operation.
You regress out the confound from the features and only continue working with
these new confound removed features. This is also the default setting for
julearn’s <cite>remove_confound</cite> step. But sometimes you want to work with the
confound even after removing it from the features. In this example, we
will discuss the options you have.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Sami Hamdan &lt;s.hamdan@fz-juelich.de&gt;</span>
<span class="c1">#</span>
<span class="c1"># License: AGPL</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_diabetes.html#sklearn.datasets.load_diabetes" title="sklearn.datasets.load_diabetes" class="sphx-glr-backref-module-sklearn-datasets sphx-glr-backref-type-py-function"><span class="n">load_diabetes</span></a>  <span class="c1"># to load data</span>
<span class="kn">from</span> <span class="nn">julearn.pipeline</span> <span class="kn">import</span> <span class="n">PipelineCreator</span>
<span class="kn">from</span> <span class="nn">julearn</span> <span class="kn">import</span> <span class="n">run_cross_validation</span>
<span class="kn">from</span> <span class="nn">julearn.inspect.preprocess</span> <span class="kn">import</span> <span class="n">preprocess</span>

<span class="c1"># load in the data</span>
<span class="n">df_features</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_diabetes.html#sklearn.datasets.load_diabetes" title="sklearn.datasets.load_diabetes" class="sphx-glr-backref-module-sklearn-datasets sphx-glr-backref-type-py-function"><span class="n">load_diabetes</span></a><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>First, we can have a look at our features.
You can see it includes Age, BMI, average blood pressure (bp) and 6 other
measures from s1 to s6 Furthermore, it includes sex which will be considered
as a confound in this example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Features: &quot;</span><span class="p">,</span> <span class="n">df_features</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Features:          age       sex       bmi  ...        s4        s5        s6
0  0.038076  0.050680  0.061696  ... -0.002592  0.019907 -0.017646
1 -0.001882 -0.044642 -0.051474  ... -0.039493 -0.068332 -0.092204
2  0.085299  0.050680  0.044451  ... -0.002592  0.002861 -0.025930
3 -0.089063 -0.044642 -0.011595  ...  0.034309  0.022688 -0.009362
4  0.005383 -0.044642 -0.036385  ... -0.002592 -0.031988 -0.046641

[5 rows x 10 columns]
</pre></div>
</div>
<p>Second, we can have a look at the target</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Target: &quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Target:  count    442.000000
mean     152.133484
std       77.093005
min       25.000000
25%       87.000000
50%      140.500000
75%      211.500000
max      346.000000
Name: target, dtype: float64
</pre></div>
</div>
<p>Now, we can put both into one DataFrame:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">df_features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>
</pre></div>
</div>
<p>In the following we will explore different settings of confound removal
using Julearns pipeline functionalities.</p>
<section id="confound-removal-typical-use-case">
<h2>Confound Removal Typical Use Case<a class="headerlink" href="#confound-removal-typical-use-case" title="Permalink to this heading"></a></h2>
<p>Here, we want to deconfound the features and not include the confound as a
feature into our last model. We will use the <cite>remove_confound</cite> step for this.
Then we will use the <cite>pca</cite> step to reduce the dimensionality of the features.
Finally, we will fit a linear regression model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;confound_removal&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;pca&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;linreg&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2023-04-06 12:14:12,307 - julearn - INFO - Adding step confound_removal that applies to ColumnTypes&lt;types={&#39;continuous&#39;}; pattern=(?:__:type:__continuous)&gt;
2023-04-06 12:14:12,308 - julearn - INFO - Step added
2023-04-06 12:14:12,308 - julearn - INFO - Adding step pca that applies to ColumnTypes&lt;types={&#39;continuous&#39;}; pattern=(?:__:type:__continuous)&gt;
2023-04-06 12:14:12,308 - julearn - INFO - Step added
2023-04-06 12:14:12,309 - julearn - INFO - Adding step linreg that applies to ColumnTypes&lt;types={&#39;continuous&#39;}; pattern=(?:__:type:__continuous)&gt;
2023-04-06 12:14:12,309 - julearn - INFO - Step added

&lt;julearn.pipeline.pipeline_creator.PipelineCreator object at 0x7febaa338430&gt;
</pre></div>
</div>
<p>Now we need to set the <cite>X_types</cite> argument of the <cite>run_cross_validation</cite>
function. This argument is a dictionary that maps the names of the different
types of X to the features that belong to this type. In this example, we
have two types of features: <cite>continuous</cite> and <cite>confound</cite>. The <cite>continuous</cite>
features are the features that we want to deconfound and the <cite>confound</cite>
features are the features that we want to remove from the <cite>continuous</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feature_names</span></a> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;sex&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_types</span></a> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;continuous&quot;</span><span class="p">:</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feature_names</span></a><span class="p">,</span> <span class="s2">&quot;confound&quot;</span><span class="p">:</span> <span class="s2">&quot;sex&quot;</span><span class="p">}</span>

<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">feature_names</span></a> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Now we can run the cross validation and get the scores.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_types</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_types</span></a><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
    <span class="n">return_estimator</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2023-04-06 12:14:12,310 - julearn - INFO - ==== Input Data ====
2023-04-06 12:14:12,310 - julearn - INFO - Using dataframe as input
2023-04-06 12:14:12,310 - julearn - INFO -      Features: [&#39;age&#39;, &#39;bmi&#39;, &#39;bp&#39;, &#39;s1&#39;, &#39;s2&#39;, &#39;s3&#39;, &#39;s4&#39;, &#39;s5&#39;, &#39;s6&#39;, &#39;sex&#39;]
2023-04-06 12:14:12,311 - julearn - INFO -      Target: target
2023-04-06 12:14:12,311 - julearn - INFO -      Expanded features: [&#39;age&#39;, &#39;bmi&#39;, &#39;bp&#39;, &#39;s1&#39;, &#39;s2&#39;, &#39;s3&#39;, &#39;s4&#39;, &#39;s5&#39;, &#39;s6&#39;, &#39;sex&#39;]
2023-04-06 12:14:12,311 - julearn - INFO -      X_types:{&#39;continuous&#39;: [&#39;age&#39;, &#39;bmi&#39;, &#39;bp&#39;, &#39;s1&#39;, &#39;s2&#39;, &#39;s3&#39;, &#39;s4&#39;, &#39;s5&#39;, &#39;s6&#39;], &#39;confound&#39;: [&#39;sex&#39;]}
2023-04-06 12:14:12,312 - julearn - INFO - ====================
2023-04-06 12:14:12,312 - julearn - INFO -
2023-04-06 12:14:12,314 - julearn - INFO - = Model Parameters =
2023-04-06 12:14:12,314 - julearn - INFO - ====================
2023-04-06 12:14:12,315 - julearn - INFO -
2023-04-06 12:14:12,315 - julearn - INFO - = Data Information =
2023-04-06 12:14:12,315 - julearn - INFO -      Problem type: regression
2023-04-06 12:14:12,315 - julearn - INFO -      Number of samples: 442
2023-04-06 12:14:12,315 - julearn - INFO -      Number of features: 10
2023-04-06 12:14:12,315 - julearn - INFO - ====================
2023-04-06 12:14:12,315 - julearn - INFO -
2023-04-06 12:14:12,315 - julearn - INFO -      Target type: float64
2023-04-06 12:14:12,315 - julearn - INFO - Using outer CV scheme KFold(n_splits=5, random_state=None, shuffle=False)
</pre></div>
</div>
<p>We can use the <cite>preprocess</cite> method of the <cite>inspect</cite> module to inspect the
transformations steps of the returned estimator.
By providing a step name to the <cite>until</cite> argument of the
<cite>preprocess</cite> method we return the transformed X and y up to
the provided step (inclusive).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_deconfounded</span>  <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="s2">&quot;confound_removal&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_deconfounded</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># As you can see the confound `sex` was dropped and only the confound removed</span>
<span class="c1"># features are used in the following pca.</span>
<span class="c1">#</span>
<span class="c1"># But what if you want to keep the confound after removal for</span>
<span class="c1"># other transformations?</span>
<span class="c1">#</span>
<span class="c1"># For example, let&#39;s assume that you want to do a pca on the confound removed</span>
<span class="c1"># feature, but want to keep the confound for the actual modelling step.</span>
<span class="c1"># Let us have a closer look to the confound remover in order to understand</span>
<span class="c1"># how we could achieve such a task:</span>
<span class="c1">#</span>
<span class="c1"># .. autoclass:: julearn.transformers.ConfoundRemover</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>        age       bmi        bp  ...        s4        s5        s6
0  0.029271  0.057228  0.009658  ... -0.019424  0.012310 -0.028194
1  0.005874 -0.047538 -0.015568  ... -0.024667 -0.061639 -0.082913
2  0.076494  0.039983 -0.017885  ... -0.019424 -0.004736 -0.036479
3 -0.081307 -0.007659 -0.025897  ...  0.049135  0.029380 -0.000071
4  0.013139 -0.032449  0.032631  ...  0.012234 -0.025295 -0.037349

[5 rows x 9 columns]
</pre></div>
</div>
<p>In this example, we will set the <cite>keep_confounds</cite> argument to True.
This will keep the confounds after confound removal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;confound_removal&quot;</span><span class="p">,</span> <span class="n">keep_confounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;pca&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;linreg&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2023-04-06 12:14:12,758 - julearn - INFO - Adding step confound_removal that applies to ColumnTypes&lt;types={&#39;continuous&#39;}; pattern=(?:__:type:__continuous)&gt;
2023-04-06 12:14:12,759 - julearn - INFO - Setting hyperparameter keep_confounds = True
2023-04-06 12:14:12,759 - julearn - INFO - Step added
2023-04-06 12:14:12,759 - julearn - INFO - Adding step pca that applies to ColumnTypes&lt;types={&#39;continuous&#39;}; pattern=(?:__:type:__continuous)&gt;
2023-04-06 12:14:12,759 - julearn - INFO - Step added
2023-04-06 12:14:12,760 - julearn - INFO - Adding step linreg that applies to ColumnTypes&lt;types={&#39;continuous&#39;}; pattern=(?:__:type:__continuous)&gt;
2023-04-06 12:14:12,760 - julearn - INFO - Step added

&lt;julearn.pipeline.pipeline_creator.PipelineCreator object at 0x7febaa3391e0&gt;
</pre></div>
</div>
<p>Now we can run the cross validation and get the scores.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_types</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_types</span></a><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
    <span class="n">return_estimator</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2023-04-06 12:14:12,760 - julearn - INFO - ==== Input Data ====
2023-04-06 12:14:12,760 - julearn - INFO - Using dataframe as input
2023-04-06 12:14:12,761 - julearn - INFO -      Features: [&#39;age&#39;, &#39;bmi&#39;, &#39;bp&#39;, &#39;s1&#39;, &#39;s2&#39;, &#39;s3&#39;, &#39;s4&#39;, &#39;s5&#39;, &#39;s6&#39;, &#39;sex&#39;]
2023-04-06 12:14:12,761 - julearn - INFO -      Target: target
2023-04-06 12:14:12,761 - julearn - INFO -      Expanded features: [&#39;age&#39;, &#39;bmi&#39;, &#39;bp&#39;, &#39;s1&#39;, &#39;s2&#39;, &#39;s3&#39;, &#39;s4&#39;, &#39;s5&#39;, &#39;s6&#39;, &#39;sex&#39;]
2023-04-06 12:14:12,761 - julearn - INFO -      X_types:{&#39;continuous&#39;: [&#39;age&#39;, &#39;bmi&#39;, &#39;bp&#39;, &#39;s1&#39;, &#39;s2&#39;, &#39;s3&#39;, &#39;s4&#39;, &#39;s5&#39;, &#39;s6&#39;], &#39;confound&#39;: [&#39;sex&#39;]}
2023-04-06 12:14:12,762 - julearn - INFO - ====================
2023-04-06 12:14:12,762 - julearn - INFO -
2023-04-06 12:14:12,764 - julearn - INFO - = Model Parameters =
2023-04-06 12:14:12,764 - julearn - INFO - ====================
2023-04-06 12:14:12,765 - julearn - INFO -
2023-04-06 12:14:12,765 - julearn - INFO - = Data Information =
2023-04-06 12:14:12,765 - julearn - INFO -      Problem type: regression
2023-04-06 12:14:12,765 - julearn - INFO -      Number of samples: 442
2023-04-06 12:14:12,765 - julearn - INFO -      Number of features: 10
2023-04-06 12:14:12,765 - julearn - INFO - ====================
2023-04-06 12:14:12,765 - julearn - INFO -
2023-04-06 12:14:12,765 - julearn - INFO -      Target type: float64
2023-04-06 12:14:12,765 - julearn - INFO - Using outer CV scheme KFold(n_splits=5, random_state=None, shuffle=False)
</pre></div>
</div>
<p>As you can see this kept the confound variable <cite>sex</cite> in the data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_deconfounded</span>  <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">until</span><span class="o">=</span><span class="s2">&quot;confound_removal&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_deconfounded</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>        age       bmi        bp  ...        s5        s6       sex
0  0.029271  0.057228  0.009658  ...  0.012310 -0.028194  0.050680
1  0.005874 -0.047538 -0.015568  ... -0.061639 -0.082913 -0.044642
2  0.076494  0.039983 -0.017885  ... -0.004736 -0.036479  0.050680
3 -0.081307 -0.007659 -0.025897  ...  0.029380 -0.000071 -0.044642
4  0.013139 -0.032449  0.032631  ... -0.025295 -0.037349 -0.044642

[5 rows x 10 columns]
</pre></div>
</div>
<p>Even after the pca, the confound will still be present.
This is the case because by default transformers only transform continuous
features (including features without a specified type)
and ignore confounds and categorical variables.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_transformed</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_transformed</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># This means that the resulting Linear Regression can use the deconfounded</span>
<span class="c1"># features together with the confound to predict the target. However, in the</span>
<span class="c1"># pipeline creator, the model is only applied to the continuous features.</span>
<span class="c1"># This means that the confound is not used in the model.</span>
<span class="c1"># Here we can see that the model is using 9 features.</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span><span class="o">.</span><span class="n">steps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="o">.</span><span class="n">coef_</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>   pca__pca0  pca__pca1  pca__pca2  ...  pca__pca7  pca__pca8       sex
0  -0.014051   0.075715   0.017395  ...  -0.008604  -0.002330  0.050680
1  -0.099883  -0.062829   0.014516  ...   0.024022   0.002075 -0.044642
2  -0.029015   0.053253   0.032477  ...  -0.001197  -0.002579  0.050680
3   0.035162  -0.001324  -0.106807  ...  -0.006566  -0.003545 -0.044642
4  -0.003951  -0.025445   0.000421  ...   0.002095  -0.000517 -0.044642

[5 rows x 10 columns]
9
</pre></div>
</div>
<p>Lastly, you can also use the confound as a normal feature after confound
removal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">creator</span> <span class="o">=</span> <span class="n">PipelineCreator</span><span class="p">(</span><span class="n">problem_type</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;continuous&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;confound_removal&quot;</span><span class="p">,</span> <span class="n">keep_confounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;pca&quot;</span><span class="p">)</span>
<span class="n">creator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;linreg&quot;</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>

<span class="n">scores</span><span class="p">,</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a> <span class="o">=</span> <span class="n">run_cross_validation</span><span class="p">(</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_types</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X_types</span></a><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="o">=</span><span class="n">creator</span><span class="p">,</span>
    <span class="n">return_estimator</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>2023-04-06 12:14:13,254 - julearn - INFO - Adding step confound_removal that applies to ColumnTypes&lt;types={&#39;continuous&#39;}; pattern=(?:__:type:__continuous)&gt;
2023-04-06 12:14:13,254 - julearn - INFO - Setting hyperparameter keep_confounds = True
2023-04-06 12:14:13,255 - julearn - INFO - Step added
2023-04-06 12:14:13,255 - julearn - INFO - Adding step pca that applies to ColumnTypes&lt;types={&#39;continuous&#39;}; pattern=(?:__:type:__continuous)&gt;
2023-04-06 12:14:13,255 - julearn - INFO - Step added
2023-04-06 12:14:13,255 - julearn - INFO - Adding step linreg that applies to ColumnTypes&lt;types={&#39;*&#39;}; pattern=.*&gt;
2023-04-06 12:14:13,256 - julearn - INFO - Step added
2023-04-06 12:14:13,256 - julearn - INFO - ==== Input Data ====
2023-04-06 12:14:13,256 - julearn - INFO - Using dataframe as input
2023-04-06 12:14:13,256 - julearn - INFO -      Features: [&#39;age&#39;, &#39;bmi&#39;, &#39;bp&#39;, &#39;s1&#39;, &#39;s2&#39;, &#39;s3&#39;, &#39;s4&#39;, &#39;s5&#39;, &#39;s6&#39;, &#39;sex&#39;]
2023-04-06 12:14:13,256 - julearn - INFO -      Target: target
2023-04-06 12:14:13,256 - julearn - INFO -      Expanded features: [&#39;age&#39;, &#39;bmi&#39;, &#39;bp&#39;, &#39;s1&#39;, &#39;s2&#39;, &#39;s3&#39;, &#39;s4&#39;, &#39;s5&#39;, &#39;s6&#39;, &#39;sex&#39;]
2023-04-06 12:14:13,257 - julearn - INFO -      X_types:{&#39;continuous&#39;: [&#39;age&#39;, &#39;bmi&#39;, &#39;bp&#39;, &#39;s1&#39;, &#39;s2&#39;, &#39;s3&#39;, &#39;s4&#39;, &#39;s5&#39;, &#39;s6&#39;], &#39;confound&#39;: [&#39;sex&#39;]}
2023-04-06 12:14:13,258 - julearn - INFO - ====================
2023-04-06 12:14:13,258 - julearn - INFO -
2023-04-06 12:14:13,261 - julearn - INFO - = Model Parameters =
2023-04-06 12:14:13,261 - julearn - INFO - ====================
2023-04-06 12:14:13,261 - julearn - INFO -
2023-04-06 12:14:13,261 - julearn - INFO - = Data Information =
2023-04-06 12:14:13,261 - julearn - INFO -      Problem type: regression
2023-04-06 12:14:13,261 - julearn - INFO -      Number of samples: 442
2023-04-06 12:14:13,261 - julearn - INFO -      Number of features: 10
2023-04-06 12:14:13,261 - julearn - INFO - ====================
2023-04-06 12:14:13,261 - julearn - INFO -
2023-04-06 12:14:13,261 - julearn - INFO -      Target type: float64
2023-04-06 12:14:13,262 - julearn - INFO - Using outer CV scheme KFold(n_splits=5, random_state=None, shuffle=False)
   fit_time  score_time  ...  fold                          cv_mdsum
0  0.048069    0.018577  ...     0  b10eef89b4192178d482d7a1587a248a
1  0.050815    0.019016  ...     1  b10eef89b4192178d482d7a1587a248a
2  0.048262    0.018579  ...     2  b10eef89b4192178d482d7a1587a248a
3  0.049793    0.018441  ...     3  b10eef89b4192178d482d7a1587a248a
4  0.047766    0.019085  ...     4  b10eef89b4192178d482d7a1587a248a

[5 rows x 8 columns]
</pre></div>
</div>
<p>As you can see the confound is now used in the linear regression model.
This is the case because we set the <cite>apply_to</cite> argument of the <cite>linreg</cite>
step to <cite>*</cite>. This means that the step will be applied to all features
(including confounds and categorical variables).
Here we can see that the model is using 10 features (9 deconfounded features
and the confound).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span><span class="o">.</span><span class="n">steps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><a href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline" class="sphx-glr-backref-module-sklearn-pipeline sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">model</span></a><span class="o">.</span><span class="n">coef_</span><span class="p">))</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  1.397 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-advanced-run-return-confounds-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/05217961c0ebf3cb63c1e97bc9c29c19/run_return_confounds.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">run_return_confounds.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/83ba9fd1d1f0d922a29a67dee4237855/run_return_confounds.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">run_return_confounds.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="run_hyperparameter_tuning.html" class="btn btn-neutral float-left" title="Tuning Hyperparameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="run_example_pca_featsets.html" class="btn btn-neutral float-right" title="Regression Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Authors of julearn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CB4ETK4DBG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-CB4ETK4DBG', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>